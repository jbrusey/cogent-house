// Generated by CoffeeScript 1.7.1
var chart, chartNodeState, chartPushStatus, navranges, pandasjson, togglePushStatus;

chart = false;

navranges = {
  buttons: [
    {
      type: "day",
      count: 1,
      text: "1d"
    }, {
      type: "day",
      count: 3,
      text: "3d"
    }, {
      type: "week",
      count: 1,
      text: "1w"
    }, {
      type: "week",
      count: 2,
      text: "2w"
    }, {
      type: "month",
      count: 1,
      text: "1m"
    }, {
      type: "ytd",
      text: "YTD"
    }, {
      type: "all",
      text: "All"
    }
  ],
  selected: 0
};

togglePushStatus = function() {
  var item, navg, nsum, series, _i, _j, _len, _len1, _ref;
  chart = $('#thegraph').highcharts();
  if (chart) {
    console.log("Chart Exists");
    _ref = chart.series;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      series = _ref[_i];
      if (series.name === "Push Status") {
        console.log("Push Status Series", series);
        series.destroy();
        return;
      }
    }
    console.log("Running End Stuff");
    nsum = 0;
    for (_j = 0, _len1 = nodepairs.length; _j < _len1; _j++) {
      item = nodepairs[_j];
      nsum += item[0];
    }
    navg = nsum / nodepairs.length;
    console.log("SUM ", nsum, " AVG ", navg);
    $.getJSON(theurl, {
      graphtype: "pushstatus",
      hostname: hostname,
      offset: navg
    }, function(data) {
      series = {
        name: "Push Status",
        data: data,
        dashStyle: "longdash",
        marker: {
          enabled: true
        }
      };
      console.log("Series to Add ", series);
      console.log("Chart ", chart);
      chart.addSeries(series);
    });
  } else {
    console.log("No Chart Exists");
    chartPushStatus();
  }
};

chartPushStatus = function() {
  chart = $('#thegraph').highcharts();
  if (chart) {
    console.log("Chart Exists");
    chart.destroy();
  } else {
    console.log("No Chart Exists");
  }
  $.getJSON(theurl, {
    graphtype: "pushstatus",
    hostname: hostname
  }, function(data) {
    $('#thegraph').highcharts("StockChart", {
      series: [
        {
          name: "Push Status",
          data: data,
          marker: {
            enabled: true
          }
        }
      ],
      xAxis: {
        type: "datetime",
        ordinal: false
      },
      rangeSelector: navranges
    });
  });
  chart = $('#thegraph').highcharts();
};

chartNodeState = function() {
  chart = $('#thegraph').highcharts();
  if (chart) {
    console.log("Chart Exists");
    chart.destroy();
  } else {
    console.log("No Chart Exists");
  }
  $.getJSON(theurl, {
    graphtype: "nodestate",
    node: nodepairs[0][0]
  }, function(data) {
    var nodepair, _i, _len, _ref;
    console.log("Data is ", data);
    $('#thegraph').highcharts("StockChart", {
      series: [data],
      xAxis: {
        type: "datetime",
        ordinal: false
      },
      rangeSelector: navranges
    });
    chart = $('#thegraph').highcharts();
    console.log("New Chart is ", chart);
    _ref = nodepairs.slice(1);
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      nodepair = _ref[_i];
      console.log("Getting Pair ", nodepair);
      $.getJSON(theurl, {
        graphtype: "nodestate",
        node: nodepair[0]
      }, function(data) {
        console.log("Data is ", data);
        return chart.addSeries(data);
      });
    }
  });
};

pandasjson = function() {
  return $.getJSON(theurl, {
    graphtype: "nodestate-pandas",
    node: nodepairs[0][0],
    hostname: hostname
  }, function(data) {
    return console.log(data);
  });
};

$(document).ready(function() {
  return chartNodeState();
});
