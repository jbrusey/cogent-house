// Generated by CoffeeScript 1.6.3
require(["dojo/topic", "dojo/io/script"], function(topic, ioscript) {
  var fetchData, plotTS;
  topic.subscribe("navTree", function(arg1) {
    console.log("--- FIRED --- Args(", arg1, ")");
    return fetchData(arg1);
  });
  fetchData = function(args) {
    console.log("Fetching Data with Args ", args);
    args.graphType = "time";
    console.log("Done");
    return ioscript.get({
      url: "jsonFetch",
      content: args,
      callbackParamName: "callback"
    }).then(function(data) {
      console.log("Data Returned ", data);
      plotTS(data);
      console.log("Plotted");
    });
  };
  plotTS = function(theData) {
    var chart, options;
    console.log("Building Time Series ", theData);
    console.log("Seires", theData.series);
    options = {
      chart: {
        renderTo: "theGraph"
      },
      title: {
        text: "CHART TITLE"
      },
      legend: {
        enabled: true,
        align: "left",
        layout: "vertical",
        verticalAlign: "top"
      },
      credits: {
        enabled: false
      },
      xAxis: {
        type: "datetime",
        ordinal: false
      },
      rangeSelector: {
        buttons: [
          {
            type: "day",
            count: 1,
            text: "1d"
          }, {
            type: "day",
            count: 3,
            text: "3d"
          }, {
            type: "week",
            count: 1,
            text: "1w"
          }, {
            type: "week",
            count: 2,
            text: "2w"
          }, {
            type: "month",
            count: 1,
            text: "1m"
          }, {
            type: "ytd",
            text: "YTD"
          }, {
            type: "all",
            text: "All"
          }
        ],
        selected: 2
      },
      series: []
    };
    options.series = theData.series;
    console.log("Options ", options);
    chart = new Highcharts.StockChart(options);
    console.log("----> TS DONE", options);
  };
});
